# Інструкція по використанню парсера

## Швидкий старт

### 1. Встановіть залежності

```bash
# Встановіть python3-venv (якщо не встановлено)
sudo apt install python3-venv

# Створіть віртуальне середовище
cd /mnt/e/pet/svitlo_kremen_tg_bot
python3 -m venv venv

# Активуйте віртуальне середовище
source venv/bin/activate

# Встановіть бібліотеку pdfplumber
pip install pdfplumber
```

### 2. Запустіть парсер

```bash
cd parser
source ../venv/bin/activate
python3 parse_pdf_v2.py
```

### 3. Результати

Після виконання ви отримаєте 3 файли:

- **addresses.csv** - адреси в CSV форматі (для Excel)
- **addresses.json** - адреси в JSON форматі (для бота)
- **parsing_stats.txt** - статистика парсингу

## Структура даних

Кожна адреса містить:

```json
{
  "branch": "Полтавська",
  "queue": 1,
  "subqueue": 1,
  "queue_full": "1.1",
  "city": "м.Полтава",
  "street": "вул. Грабчака",
  "house": "10"
}
```

## Статистика парсингу

- **Всього адрес**: 3551
- **Черга 1.1**: 1462 адреси
- **Черга 3.1**: 581 адреса
- **Черга 5.1**: 1508 адрес

## Використання в Telegram боті

1. Завантажте файл `addresses.json` у ваш Kotlin проект
2. Використайте клас `AddressLookup` з файлу `bot/examples/AddressLookup.kt`
3. Реалізуйте обробники команд для вашого бота

### Приклад використання в Kotlin

```kotlin
val lookup = AddressLookup("addresses.json")

// Знайти чергу за адресою
val queue = lookup.findQueue("м.Полтава", "вул. Грабчака", "10")
println("Черга: $queue") // Виведе: Черга: 1.1

// Отримати список міст
val cities = lookup.getCities()

// Отримати список вулиць у місті
val streets = lookup.getStreets("м.Полтава")

// Отримати список будинків на вулиці
val houses = lookup.getHouses("м.Полтава", "вул. Грабчака")
```

## Налаштування парсера

Якщо потрібно парсити інші філії (не тільки Полтавську), відредагуйте файл `parse_pdf_v2.py`:

```python
# Знайдіть цей рядок (близько рядка 237)
if current_branch != 'Полтавська':
    continue

# Змініть на:
# if current_branch not in ['Полтавська', 'Кременчуцька']:
#     continue
```

## Проблеми та рішення

### Помилка: "No module named 'pdfplumber'"
**Рішення**: Переконайтеся, що ви активували віртуальне середовище:
```bash
source ../venv/bin/activate
```

### Помилка: "externally-managed-environment"
**Рішення**: Використовуйте віртуальне середовище (див. розділ "Встановіть залежності")

### Мало адрес у результаті
**Рішення**: Перевірте, що ви використовуєте правильний PDF файл і що він містить дані для Полтавської філії

## Оновлення даних

При отриманні нового PDF файлу:

1. Замініть файл `HPV_25_26-zminy-hruden.pdf` на новий
2. Змініть ім'я файлу в `parse_pdf_v2.py` (рядок 10):
   ```python
   PDF_FILE = "новий_файл.pdf"
   ```
3. Запустіть парсер знову
